# Microservice

## 介绍
微服务演示代码库

## 为什么要用SpringCloud？

​		1.1. 解决异构系统之间复杂的交互问题，屏蔽不同编程语言的差异性

​		1.2. SpringCloud生态好，稳定可靠

​		1.3. 对于网络的容错性比较好，HTTP请求是无状态的，请求不成功可以向其他副本再发起 请求。

​		1.4. 服务可插拔特性。部分服务的上下线，不会对整体服务造成影响。

## 单体应用

1. 大体概念：所有功能全部打包在一起。应用大部分是一个war包或jar包。随着业务发展，功能增多，这个项目会越来越臃肿。

2. 优点：容易开发、测试、部署，适合项目初期试错。

3. 坏处

   ​		随着项目越来越复杂，团队不断扩大。问题愈发明显：

   - 复杂性高：代码多，十万行，百万行级别甚至更多。加一个小功能，会带来其他功能的隐患，因为代码全都耦合在一起。

   - 技术债务：由于人员流动，项目是不坏不修，因为不敢修。

   - 持续部署困难：由于是全量应用，改一个小功能，整个项目需要新部署，会导致无关的功能暂停使用。编译部署上线耗时长，不敢随便部署，导致部署频率低，进而又导致两次部署之间，功能修改越多，越不敢部署，恶性循环。

   - 可靠性差：出现小问题，如某个功能出现OOM，会导致整个应用崩溃。

   - 扩展受限：只能整体扩展，无法按照需要进行扩展，不能根据计算密集型（派单系统）和IO密集型（文件服务） 进行合适的区分。

   - 阻碍创新：单体应用是以一种技术解决所有问题，不容易引入新技术。但在高速的互联网发展过程中，适应的潮流是：用合适的语言做合适的事情。比如在单体应用中，一个项目用spring MVC，想换成spring boot，切换成本很高，因为有可能10万，百万行代码都要改，而微服务可以轻松切换，因为每个服务，功能简单，代码少。

## SOA

​		对单体应用的改进：引入SOA（Service-Oriented Architecture）面向服务架构，拆分系统，用服务的流程化来实现业务的灵活性。服务间需要某些方法进行连接，面向接口等，它是一种设计方法，其中包含多个服务， 服务之间通过相互依赖最终提供一系列的功能。一个服务 通常以独立的形式存在于操作系统进程中。各个服务之间 通过网络调用。但是还是需要用些方法来进行服务组合，有可能还是个单体应用。

## 微服务

​		微服务，是SOA思想的一种具体实践，它是一种架构风格，将单体应用划分为小型的服务单元；它是使用一系列粒度较小的服务来开发单个应用的方式；每个服务运行在自己的进程中；服务间采用轻量级的方式进行通信(通常是HTTP API)；这些服务是基于业务逻辑和范围，通过自动化部署的机制来独立部署的，并且服务的集中管理应该是最低限度的，即每个服务可以采用不同的编程语言编写，使用不同的数据存储技术。关于微服务，更多参考：http://www.martinfowler.com/articles/microservices.html

### 特性

- 独立运行在自己进程中
- 一系列独立服务共同构建起整个系统

- 一个服务只关注自己的独立业务

- 轻量的通信机制RESTful API

- 可使用不同语言开发不同服务

- 全自动部署机制

### 优点

1. 独立部署。不依赖其他服务，耦合性低，不用管其他服务的部署对自己的影响。
2. 易于开发和维护：关注特定业务，所以业务清晰，代码量少，模块变的易开发、易理解、易维护。
3. 启动快：功能少，代码少，所以启动快，有需要停机维护的服务，不会长时间暂停服务。
4. 局部修改容易：只需要部署相应的服务即可，适合敏捷开发。
5. 技术栈不受限：java，node.js等
6. 按需伸缩：某个服务受限，可以按需增加内存，cpu等。
7. 职责专一：专门团队负责专门业务，有利于团队分工。
8. 代码复用：很多代码不需要重复编写，底层实现通过接口方式提供。
9. 便于团队协作：每个团队只需要提供API就行，定义好API后，可以并行开发。

### 缺点

1. 分布式固有的复杂性：容错（某个服务宕机），网络延时，调用关系、分布式事务等，都会使复杂性增加。
2. 分布式事务的挑战：每个服务有自己的数据库，优点在于不同服务可以选择适合自身业务的数据库。如订单用MySQL，评论用Mongodb等。目前最理想解决方案是：柔性事务的最终一致性。

- 刚性事务：遵循ACID原则，强一致性。

- 柔性事务：遵循BASE理论，最终一致性；与刚性事务不同，柔性事务允许一定时间内，不同节点的数据不一致，但要求最终一致。

- BASE 是 Basically Available(基本可用)、Soft state(软状态)和 Eventually consistent (最终一致性)三个短语的缩写。BASE理论是对CAP中AP的一个扩展，通过牺牲强一致性来获得可用性，当出现故障允许部分不可用但要保证核心功能可用，允许数据在一段时间内是不一致的，但最终达到一致状态。满足BASE理论的事务，我们称之为“柔性事务”。

3. 接口调整成本高：改一个接口，调用方都要改。

4. 测试难度提升：一个接口改变，所有调用方都得测。自动化测试就变的重要了。API文档的管理也尤为重要。推荐：yapi。

5. 运维要求高：需要维护 几十 上百个服务。监控变的复杂。并且还要关注多个集群，不像原来单体应用，一个应用正常运行即可。

6. 重复工作：比如java的工具类可以在共享common.jar中，但在多语言下行不通，C++无法直接用java的jar包。

### 设计原则

- 单一职责原则：关注整个系统功能中单独，有界限的一部分。

- 服务自治原则：可以独立开发，测试，构建，部署，运行，与其他服务解耦。

- 轻量级通信原则：轻，跨平台，跨语言。REST,AMQP 等。

- 粒度把控：与自己实际相结合。 不要追求完美，随业务进化而调整。可参考《淘宝技术这10年》。

## SpringCloud

### 概念

​		Spring Cloud是实现微服务架构的一系列框架的有机集合。是在Spring Boot基础上构建的，用于简化分布式系统构建的工具集。是拥有众多子项目的项目集合。利用Spring Boot的开发便利性，巧妙地简化了分布式系统基础设施（服务注册与发现、负载均衡、网关路由、熔断机制、配置中心、消息总线、链路追踪等）的开发。

### 版本参考

​		https://spring.io/projects/spring-cloud

​		版本记录：https://github.com/spring-cloud/spring-cloud-release/releases